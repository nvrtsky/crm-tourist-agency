По этим логам у вас сейчас две конкретные технические проблемы, которые и дают “странное” поведение в iFrame:

Вы перестали передавать activeChat.channelId (его нет в payload).

Ваш сервер не может получить список чатов из Wazzup: Failed to get chats: 404, поэтому он и не знает, какой channelId подставить.

Пока вы не восстановите получение чатов (и/или канал для номера), iFrame будет открываться в “неполном” контексте: история может пропадать, канал будет “неизвестный”, а пользователи будут уходить в “Все чаты” и получать read-only.

1) Срочно исправить payload iFrame

Сейчас у вас:

"activeChat": { "chatType": "whatsapp", "chatId": "79257854600" }


Должно быть:

"activeChat": {
  "chatType": "whatsapp",
  "chatId": "79257854600",
  "channelId": "<WHATSAPP_CHANNEL_ID_FOR_THIS_CHAT>"
}


Без channelId Wazzup часто не может однозначно привязать чат к правильному каналу (особенно если несколько каналов/интеграций).

2) Разобрать Failed to get chats: 404 (это корень)

404 от Wazzup почти всегда означает одно из трёх:

A) Неверный URL/endpoint (самое частое)

Вы обращаетесь не к тому пути (например, /v3/chats вместо корректного, или перепутан базовый URL).

Что проверить в коде прямо сейчас:

какой именно URL вы логируете при запросе чатов (полный URL + метод)

есть ли в пути /v3/...

не используется ли случайно “короткий” baseUrl вроде https://app.wazzup24.com/... вместо https://api.wazzup24.com/...

Если вы не логируете полный URL — добавьте лог на 1 запрос.

B) Неверный HTTP-метод

Некоторые endpoints у Wazzup завязаны на GET, а вы могли дернуть POST или наоборот — иногда это даёт 404 (в зависимости от прокси/роутинга).

C) Вы дергаете endpoint, которого нет в вашей версии API/доках

У Wazzup есть отличия по версиям (/v2, /v3) и наборам методов. Если брали пример “из головы” — 404 закономерен.

3) Как обойти 404 и быстро вернуть channelId (временный workaround)

Если “получение чатов” сейчас сломано, но канал вам нужен срочно:

Получите список каналов (обычно endpoint стабильнее, чем “chats”).

Возьмите whatsapp channelId, который реально обслуживает этот номер (у вас ранее в логах уже был список и вы выбирали канал).

Жёстко подставляйте channelId в activeChat хотя бы на время.

Но правильный путь — всё же починить “get chats”, потому что у вас могут быть:

несколько WhatsApp каналов,

разные состояния (active/blocked),

один chatId в разных каналах.

4) Почему у вас снова появляется “Просмотреть все диалоги”

Потому что:

iFrame открывается “криво” (без канала/без истории),

пользователь пытается найти переписку через “Все чаты”,

и попадает в read-only режим (это поведение Wazzup неизбежно).

Что сделать прямо сейчас (конкретный план)

Верните activeChat.channelId в payload (обязательно).

Найдите причину 404:

покажите (или сами посмотрите) в коде: полный URL + метод запроса “get chats”.

Если надо “срочно в прод”:

временно используйте известный рабочий whatsapp channelId (из конфигурации) и не дергайте “get chats” до фикса.

Чтобы я дал точечный ответ “что именно поправить”

Скопируйте сюда одну строку/блок из кода (можно без токена), где вы делаете запрос чатов:

baseUrl

path

method

пример итогового URL (шаблон)

Например:

fetch(`${WZ_BASE}/v3/chats?phone=${chatId}`, { method: 'GET', headers: {...}})


И я сразу скажу: “endpoint неверный / метод неверный / baseUrl неверный / должен быть другой путь”, без гаданий.