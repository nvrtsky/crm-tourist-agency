# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: –í–µ–±-—Å–µ—Ä–≤–∏—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥—Ä—É–ø–ø–æ–π —Ç—É—Ä–∏—Å—Ç–æ–≤

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
1. [–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã](#–æ–±–∑–æ—Ä-—Å–∏—Å—Ç–µ–º—ã)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö Bitrix24](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–¥–∞–Ω–Ω—ã—Ö-bitrix24)
3. [–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö](#–∏—Å—Ç–æ—á–Ω–∏–∫–∏-–¥–∞–Ω–Ω—ã—Ö)
4. [–†—É—á–Ω–æ–π –≤–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö](#—Ä—É—á–Ω–æ–π-–≤–≤–æ–¥-–¥–∞–Ω–Ω—ã—Ö)
5. [–û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª](#–æ—Å–Ω–æ–≤–Ω–æ–π-—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª)
6. [–°–∏—Å—Ç–µ–º–∞ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏](#—Å–∏—Å—Ç–µ–º–∞-–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏)
7. [–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Bitrix24](#—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è-—Å-bitrix24)
8. [–≠–∫—Å–ø–æ—Ä—Ç –∏ –æ–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏](#—ç–∫—Å–ø–æ—Ä—Ç-–∏-–æ–±–º–µ–Ω-–¥–∞–Ω–Ω—ã–º–∏)
9. [–†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (DEV)](#—Ä–µ–∂–∏–º-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏-dev)
10. [–ò–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è](#–∏–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è)

---

## –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

–í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥—Ä—É–ø–ø–∞–º–∏ —Ç—É—Ä–∏—Å—Ç–æ–≤ –ø–æ 5 –≥–æ—Ä–æ–¥–∞–º –ö–∏—Ç–∞—è: **–ü–µ–∫–∏–Ω**, **–õ–æ—è–Ω**, **–°–∏–∞–Ω—å**, **–ß–∂–∞–Ω—Ü–∑—è—Ü–∑–µ**, **–®–∞–Ω—Ö–∞–π**.

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –í—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –∫–∞–∫ –≤–∫–ª–∞–¥–∫–∞ –≤ Smart Process "–°–æ–±—ã—Ç–∏–µ" (ENTITY_TYPE_ID = 176) –≤ Bitrix24.

**–¶–µ–ª—å**: –£–ø—Ä–æ—Å—Ç–∏—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø–æ–≤—ã–º–∏ —Ç—É—Ä–∞–º–∏, –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ç—É—Ä–∏—Å—Ç–æ–≤, –º–∞—Ä—à—Ä—É—Ç–æ–≤ –∏ —Å–¥–µ–ª–æ–∫ –≤ –µ–¥–∏–Ω–æ–π —Å–≤–æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ.

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö Bitrix24

### –ò–µ—Ä–∞—Ä—Ö–∏—è —Å—É—â–Ω–æ—Å—Ç–µ–π

```
Event (Smart Process "–°–æ–±—ã—Ç–∏–µ", ENTITY_TYPE_ID = 176)
  ‚îî‚îÄ‚Üí ufCrm9_1711887457 (–º–∞—Å—Å–∏–≤ ID —Å–¥–µ–ª–æ–∫)
        ‚îî‚îÄ‚Üí Deal (–°–¥–µ–ª–∫–∞)
              ‚îú‚îÄ‚Üí TITLE (–Ω–∞–∑–≤–∞–Ω–∏–µ —Å–¥–µ–ª–∫–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä "–ú–∞—Ä—Ç 2025 - –ì—Ä—É–ø–ø–∞ –ê")
              ‚îú‚îÄ‚Üí ufCrm1702460537 (–º–∞—Å—Å–∏–≤ ID –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ - —Ç—É—Ä–∏—Å—Ç–æ–≤)
              ‚îú‚îÄ‚Üí ufCrm1715027519285 (–î–æ–ø–ª–∞—Ç–∞, –æ–±—â–∞—è –¥–ª—è –≤—Å–µ–π —Å–¥–µ–ª–∫–∏)
              ‚îî‚îÄ‚Üí ufCrm1695942299984 (–ù–æ—á–µ–π, –æ–±—â–µ–µ –¥–ª—è –≤—Å–µ–π —Å–¥–µ–ª–∫–∏)
                    ‚îî‚îÄ‚Üí Contact (–ö–æ–Ω—Ç–∞–∫—Ç - —Ç—É—Ä–∏—Å—Ç)
                          ‚îú‚îÄ‚Üí ufCrm1700666127661 (–§–ò–û —Ç—É—Ä–∏—Å—Ç–∞)
                          ‚îú‚îÄ‚Üí ufCrm1700667203530 (–ü–∞—Å–ø–æ—Ä—Ç)
                          ‚îú‚îÄ‚Üí PHONE[0].VALUE (–¢–µ–ª–µ—Ñ–æ–Ω)
                          ‚îú‚îÄ‚Üí EMAIL[0].VALUE (Email)
                          ‚îî‚îÄ‚Üí BIRTHDATE (–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è)
```

### –ü–æ–ª—è Custom Fields

| –°—É—â–Ω–æ—Å—Ç—å | –ü–æ–ª–µ Bitrix24 | –ù–∞–∑–≤–∞–Ω–∏–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|---------------|----------|-----|----------|
| **Event** | `ufCrm9_1711887457` | Deals | Array[int] | –ú–∞—Å—Å–∏–≤ ID —Å–¥–µ–ª–æ–∫ |
| **Deal** | `TITLE` | –ù–∞–∑–≤–∞–Ω–∏–µ | string | –ù–∞–∑–≤–∞–Ω–∏–µ —Å–¥–µ–ª–∫–∏ (–æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –≥—Ä—É–ø–ø–∞—Ö) |
| **Deal** | `ufCrm1702460537` | Tourists | Array[int] | –ú–∞—Å—Å–∏–≤ ID –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ (—Ç—É—Ä–∏—Å—Ç–æ–≤) |
| **Deal** | `ufCrm1715027519285` | –î–æ–ø–ª–∞—Ç–∞ | string | –î–æ–ø–ª–∞—Ç–∞ (–æ–±—â–∞—è –¥–ª—è —Å–¥–µ–ª–∫–∏) |
| **Deal** | `ufCrm1695942299984` | –ù–æ—á–µ–π | string | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ—á–µ–π (–æ–±—â–µ–µ –¥–ª—è —Å–¥–µ–ª–∫–∏) |
| **Contact** | `ufCrm1700666127661` | –§–ò–û | string | –ü–æ–ª–Ω–æ–µ –∏–º—è —Ç—É—Ä–∏—Å—Ç–∞ |
| **Contact** | `ufCrm1700667203530` | –ü–∞—Å–ø–æ—Ä—Ç | string | –ù–æ–º–µ—Ä –ø–∞—Å–ø–æ—Ä—Ç–∞ |
| **Contact** | `PHONE[0].VALUE` | –¢–µ–ª–µ—Ñ–æ–Ω | string | –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ |
| **Contact** | `EMAIL[0].VALUE` | Email | string | Email –∞–¥—Ä–µ—Å |
| **Contact** | `BIRTHDATE` | –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è | date | –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è (ISO —Ñ–æ—Ä–º–∞—Ç) |

---

## –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ Bitrix24

–ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏–∑ –≤–∫–ª–∞–¥–∫–∏ Smart Process "–°–æ–±—ã—Ç–∏–µ" –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è:

**–ò–∑ Event**:
- `title` - –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è (–æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ —Å–≤–æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã)
- `deals[]` - –º–∞—Å—Å–∏–≤ —Å–¥–µ–ª–æ–∫ —Å –∏—Ö –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏

**–ò–∑ Deal** (–¥–ª—è –∫–∞–∂–¥–æ–π —Å–¥–µ–ª–∫–∏):
- `bitrixDealId` - ID —Å–¥–µ–ª–∫–∏ (–¥–ª—è –≥–∏–ø–µ—Ä—Å—Å—ã–ª–æ–∫)
- `TITLE` - –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–¥–µ–ª–∫–∏ (–æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –≥—Ä—É–ø–ø–∞—Ö –≤–º–µ—Å—Ç–æ ID)
- `surcharge` - –¥–æ–ø–ª–∞—Ç–∞ (–æ–±—â–∞—è –¥–ª—è —Ç—É—Ä–∏—Å—Ç–æ–≤ –≤ —Å–¥–µ–ª–∫–µ)
- `nights` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ—á–µ–π (–æ–±—â–µ–µ –¥–ª—è —Ç—É—Ä–∏—Å—Ç–æ–≤ –≤ —Å–¥–µ–ª–∫–µ)

**–ò–∑ Contact** (–¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç—É—Ä–∏—Å—Ç–∞):
- `bitrixContactId` - ID –∫–æ–Ω—Ç–∞–∫—Ç–∞ (–¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏)
- `name` - –§–ò–û
- `passport` - –Ω–æ–º–µ—Ä –ø–∞—Å–ø–æ—Ä—Ç–∞
- `phone` - —Ç–µ–ª–µ—Ñ–æ–Ω
- `email` - email
- `birthDate` - –¥–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è

### 2. –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ localStorage

**Custom Groupings** (`tourGroupings`):
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ —Ç—É—Ä–∏—Å—Ç–æ–≤
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞: `Map<groupId, touristIds[]>`
- –ù–µ–∑–∞–≤–∏—Å–∏–º—ã –æ—Ç Bitrix24, —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ

**Ungrouped Tourists** (`tourUngrouped`):
- –ù–∞–±–æ—Ä ID —Ç—É—Ä–∏—Å—Ç–æ–≤, –∏—Å–∫–ª—é—á–µ–Ω–Ω—ã—Ö –∏–∑ –∞–≤—Ç–æ–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞: `Set<touristId>`

### 3. In-memory storage (development)

–í development —Ä–µ–∂–∏–º–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞ (`server/storage.ts`):
- –¢—É—Ä–∏—Å—Ç—ã (`tourists`)
- –í–∏–∑–∏—Ç—ã –ø–æ –≥–æ—Ä–æ–¥–∞–º (`visits`)

---

## –†—É—á–Ω–æ–π –≤–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö

–°–ª–µ–¥—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ **–ù–ï** –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ Bitrix24 –∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –≤—Ä—É—á–Ω—É—é –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ:

### –ú–∞—Ä—à—Ä—É—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (Visits)

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –≥–æ—Ä–æ–¥–∞ –≤ –º–∞—Ä—à—Ä—É—Ç–µ —Ç—É—Ä–∏—Å—Ç–∞ –≤—Ä—É—á–Ω—É—é –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è:

#### 1. –î–∞—Ç—ã –∏ –≤—Ä–µ–º—è
- **–î–∞—Ç–∞ –ø—Ä–∏–±—ã—Ç–∏—è** (`arrivalDate`) - –¥–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ ISO
- **–í—Ä–µ–º—è –ø—Ä–∏–±—ã—Ç–∏—è** (`arrivalTime`) - –≤—Ä–µ–º—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ HH:mm
- **–î–∞—Ç–∞ –æ—Ç—ä–µ–∑–¥–∞** (`departureDate`) - –¥–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ ISO
- **–í—Ä–µ–º—è –æ—Ç—ä–µ–∑–¥–∞** (`departureTime`) - –≤—Ä–µ–º—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ HH:mm

#### 2. –û—Ç–µ–ª—å
- **–ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ç–µ–ª—è** (`hotelName`) - —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ
- **–¢–∏–ø –∫–æ–º–Ω–∞—Ç—ã** (`roomType`) - –≤—ã–±–æ—Ä –∏–∑ —Å–ø–∏—Å–∫–∞: "Twin" –∏–ª–∏ "Double"

#### 3. –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç –ø—Ä–∏–±—ã—Ç–∏—è
- **–¢–∏–ø —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞** (`arrivalTransportType`) - –≤—ã–±–æ—Ä: "–°–∞–º–æ–ª–µ—Ç" –∏–ª–∏ "–ü–æ–µ–∑–¥"
- **–ù–æ–º–µ—Ä —Ä–µ–π—Å–∞/–ø–æ–µ–∑–¥–∞** (`arrivalFlightNumber`)
- **–ê—ç—Ä–æ–ø–æ—Ä—Ç/–í–æ–∫–∑–∞–ª** (`arrivalAirport`)
- **–¢—Ä–∞–Ω—Å—Ñ–µ—Ä** (`arrivalTransfer`) - —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ

#### 4. –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç –æ—Ç—ä–µ–∑–¥–∞
- **–¢–∏–ø —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞** (`departureTransportType`) - –≤—ã–±–æ—Ä: "–°–∞–º–æ–ª–µ—Ç" –∏–ª–∏ "–ü–æ–µ–∑–¥"
- **–ù–æ–º–µ—Ä —Ä–µ–π—Å–∞/–ø–æ–µ–∑–¥–∞** (`departureFlightNumber`)
- **–ê—ç—Ä–æ–ø–æ—Ä—Ç/–í–æ–∫–∑–∞–ª** (`departureAirport`)
- **–¢—Ä–∞–Ω—Å—Ñ–µ—Ä** (`departureTransfer`) - —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ

### –†–µ–∂–∏–º—ã –≤–≤–æ–¥–∞

#### Desktop (—à–∏—Ä–æ–∫–∏–π —ç–∫—Ä–∞–Ω)
- **Inline editing**: –í—Å–µ –ø–æ–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä—É—é—Ç—Å—è –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –≤ —è—á–µ–π–∫–∞—Ö —Ç–∞–±–ª–∏—Ü—ã
- **Input fields** —Å –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞ (onBlur)
- **Select dropdowns** –¥–ª—è —Ç–∏–ø–æ–≤ –∫–æ–º–Ω–∞—Ç –∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞

#### Mobile (—É–∑–∫–∏–π —ç–∫—Ä–∞–Ω)
- –ö–∞—Ä—Ç–æ—á–∫–∏ —Ç—É—Ä–∏—Å—Ç–æ–≤ —Å –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–º —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ–º –ø–æ–ª–µ–π
- –¢–µ –∂–µ –ø–æ–ª—è, –Ω–æ –≤ –±–æ–ª–µ–µ –∫–æ–º–ø–∞–∫—Ç–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
- –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º scrolling

---

## –û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

### 1. –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ (Summary)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞**:
- –ö–æ–ª–æ–Ω–∫–∞ "‚Ññ" - –ø–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä
- –ö–æ–ª–æ–Ω–∫–∞ "–¢—É—Ä–∏—Å—Ç" - –§–ò–û, —Ç–µ–ª–µ—Ñ–æ–Ω, –ø–∞—Å–ø–æ—Ä—Ç, –î–†, –¥–æ–ø–ª–∞—Ç–∞, –Ω–æ—á–µ–π
- 5 –∫–æ–ª–æ–Ω–æ–∫ –≥–æ—Ä–æ–¥–æ–≤: –ü–µ–∫–∏–Ω, –õ–æ—è–Ω, –°–∏–∞–Ω—å, –ß–∂–∞–Ω—Ü–∑—è—Ü–∑–µ, –®–∞–Ω—Ö–∞–π
  - –í –∫–∞–∂–¥–æ–π –∫–æ–ª–æ–Ω–∫–µ: –ø—Ä–∏–±—ã—Ç–∏–µ, –æ—Ç—ä–µ–∑–¥, –æ—Ç–µ–ª—å, —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- **Sticky headers**: –ó–∞–≥–æ–ª–æ–≤–∫–∏ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω—ã –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ
- **Responsive design**: –ü–æ–ª–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ mobile
- **Cell merging**: –í–∏–∑—É–∞–ª—å–Ω–æ–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —è—á–µ–µ–∫ –≤ –≥—Ä—É–ø–ø–∞—Ö
- **Hyperlinks**: –ö–ª–∏–∫ –Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–¥–µ–ª–∫–∏ ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç Deal –≤ Bitrix24
- **Empty state**: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ "‚Äî" –¥–ª—è –ø—É—Å—Ç—ã—Ö –ø–æ–ª–µ–π —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

### 2. Dashboard (–î–∞—à–±–æ—Ä–¥ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏)

**–ú–µ—Ç—Ä–∏–∫–∏**:
- –í—Å–µ–≥–æ —Ç—É—Ä–∏—Å—Ç–æ–≤
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –≥–æ—Ä–æ–¥–∞–º
- –ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ –ø—Ä–∏–±—ã—Ç–∏—è (7 –¥–Ω–µ–π)
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –æ—Ç–µ–ª–µ–π
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ç–∏–ø–∞–º –∫–æ–º–Ω–∞—Ç (Twin/Double)

### 3. –°–ø–∏—Å–æ–∫ —Ç—É—Ä–∏—Å—Ç–æ–≤

–ü—Ä–æ—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç—É—Ä–∏—Å—Ç–æ–≤ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é:
- –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö —Ç—É—Ä–∏—Å—Ç–∞
- –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –≤ Summary

---

## –°–∏—Å—Ç–µ–º–∞ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏

### –¢—Ä–∏ —Ä–µ–∂–∏–º–∞ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏

#### 1. Auto-–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
**–õ–æ–≥–∏–∫–∞**: –¢—É—Ä–∏—Å—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç—Å—è –ø–æ `bitrixDealId`
- –ï—Å–ª–∏ —É —Ç—É—Ä–∏—Å—Ç–æ–≤ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π `bitrixDealId` ‚Üí –æ–Ω–∏ –≤ –æ–¥–Ω–æ–π –≥—Ä—É–ø–ø–µ
- –ì—Ä—É–ø–ø–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–¥–µ–ª–∫–∏ (TITLE) –≤–º–µ—Å—Ç–æ ID
- –ï—Å–ª–∏ –Ω–µ—Ç dealId ‚Üí —Ç—É—Ä–∏—Å—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ —Å "–ë–µ–∑ —Å–¥–µ–ª–∫–∏"

**ID –≥—Ä—É–ø–ø—ã**: `auto-${dealId}`

#### 2. Custom-–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ (—Ä—É—á–Ω–∞—è)
**–õ–æ–≥–∏–∫–∞**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Ä—É—á–Ω—É—é –≤—ã–±–∏—Ä–∞–µ—Ç —Ç—É—Ä–∏—Å—Ç–æ–≤ –∏ –≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç –∏—Ö
- –û—Ç–º–µ—á–∞–µ–º checkbox —É –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç—É—Ä–∏—Å—Ç–æ–≤
- –ö–ª–∏–∫ "–°–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å" ‚Üí —Å–æ–∑–¥–∞–µ—Ç—Å—è –∫–∞—Å—Ç–æ–º–Ω–∞—è –≥—Ä—É–ø–ø–∞
- –ì—Ä—É–ø–ø–∞ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç—É—Ä–∏—Å—Ç–æ–≤ –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Å–¥–µ–ª–æ–∫
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ localStorage –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç Bitrix24

**ID –≥—Ä—É–ø–ø—ã**: `custom-${timestamp}`

**–ó–∞–≥–æ–ª–æ–≤–æ–∫ –≥—Ä—É–ø–ø—ã**:
- –ï—Å–ª–∏ —Ç—É—Ä–∏—Å—Ç—ã –∏–∑ –æ–¥–Ω–æ–π —Å–¥–µ–ª–∫–∏: "–°–¥–µ–ª–∫–∞: [–ù–∞–∑–≤–∞–Ω–∏–µ]"
- –ï—Å–ª–∏ —Ç—É—Ä–∏—Å—Ç—ã –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Å–¥–µ–ª–æ–∫: "–°–¥–µ–ª–∫–∏: [–ù–∞–∑–≤–∞–Ω–∏–µ1], [–ù–∞–∑–≤–∞–Ω–∏–µ2]..."

#### 3. Ungrouped (—Ä–∞–∑–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ)
**–õ–æ–≥–∏–∫–∞**: –ò—Å–∫–ª—é—á–µ–Ω–∏–µ —Ç—É—Ä–∏—Å—Ç–∞ –∏–∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏
- –û—Ç–º–µ—á–∞–µ–º checkbox —É —Ç—É—Ä–∏—Å—Ç–∞
- –ö–ª–∏–∫ "–†–∞–∑–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å" ‚Üí —Ç—É—Ä–∏—Å—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ `ungroupedTourists`
- –¢—É—Ä–∏—Å—Ç –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ, –¥–∞–∂–µ –µ—Å–ª–∏ —É –Ω–µ–≥–æ –µ—Å—Ç—å dealId
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ localStorage

**ID –≥—Ä—É–ø–ø—ã**: `ungrouped-${touristId}`

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏

–°–∏—Å—Ç–µ–º–∞ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø–æ—Ä—è–¥–∫–µ:

```
1. Manual Ungrouped (–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
   ‚Üì –µ—Å–ª–∏ —Ç—É—Ä–∏—Å—Ç –ù–ï –≤ ungroupedTourists
2. Custom Groups
   ‚Üì –µ—Å–ª–∏ —Ç—É—Ä–∏—Å—Ç –ù–ï –≤ customGroupings
3. Auto-group by dealId (–Ω–∏–∑—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
```

### Smart Field Merging

**–ü–æ–ª—è "–î–æ–ø–ª–∞—Ç–∞" –∏ "–ù–æ—á–µ–π"** –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –æ—Å–æ–±—ã–º –æ–±—Ä–∞–∑–æ–º:

**–£—Å–ª–æ–≤–∏–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ –≥—Ä—É–ø–ø—ã**:
```typescript
const shouldMergeSurchargeNights = 
  (isSingleDealGroup && group.tourists.length > 1) ||  // –ì—Ä—É–ø–ø–∞ —Å –æ–¥–Ω–æ–π —Å–¥–µ–ª–∫–æ–π –∏ >1 —Ç—É—Ä–∏—Å—Ç
  (isCustomGroup && group.tourists.length === 1);       // –ö–∞—Å—Ç–æ–º–Ω–∞—è –≥—Ä—É–ø–ø–∞ —Å 1 —Ç—É—Ä–∏—Å—Ç–æ–º
```

**–ï—Å–ª–∏ —É—Å–ª–æ–≤–∏–µ TRUE**:
- "–î–æ–ø–ª–∞—Ç–∞" –∏ "–ù–æ—á–µ–π" –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è **–æ–¥–∏–Ω —Ä–∞–∑** –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ –≥—Ä—É–ø–ø—ã
- –í –∫–∞—Ä—Ç–æ—á–∫–∞—Ö —Ç—É—Ä–∏—Å—Ç–æ–≤ —ç—Ç–∏ –ø–æ–ª—è **—Å–∫—Ä—ã—Ç—ã**

**–ï—Å–ª–∏ —É—Å–ª–æ–≤–∏–µ FALSE**:
- "–î–æ–ø–ª–∞—Ç–∞" –∏ "–ù–æ—á–µ–π" –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è **–≤ –∫–∞–∂–¥–æ–π** –∫–∞—Ä—Ç–æ—á–∫–µ —Ç—É—Ä–∏—Å—Ç–∞

**–¶–µ–ª—å**: –£–º–µ–Ω—å—à–∏—Ç—å –∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –∫–æ–≥–¥–∞ –≤—Å–µ —Ç—É—Ä–∏—Å—Ç—ã –∏–º–µ—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

### –í–∏–∑—É–∞–ª—å–Ω–æ–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —è—á–µ–µ–∫ –≥–æ—Ä–æ–¥–æ–≤

–ü—Ä–∏ —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–∏ –≥—Ä—É–ø–ø—ã (collapse):
- –Ø—á–µ–π–∫–∏ –≥–æ—Ä–æ–¥–æ–≤ –≤–∏–∑—É–∞–ª—å–Ω–æ –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è (`rowSpan`)
- –û—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤–æ–≥–æ —Ç—É—Ä–∏—Å—Ç–∞ –≤ –≥—Ä—É–ø–ø–µ
- –≠–∫–æ–Ω–æ–º–∏—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞

---

## –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Bitrix24

### –ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤

**–í–ê–ñ–ù–û**: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ **–ù–ï –°–û–ó–î–ê–ï–¢** –Ω–æ–≤—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã –≤ Bitrix24!

**–û–ø–µ—Ä–∞—Ü–∏–∏ UPDATE** (—Ä–∞–∑—Ä–µ—à–µ–Ω—ã):
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ —Å `bitrixContactId`
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–ª–µ–π: name, passport, phone, email, birthDate

**–û–ø–µ—Ä–∞—Ü–∏–∏ DELETE** (—Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ):
- –£–¥–∞–ª–µ–Ω–∏–µ —Ç—É—Ä–∏—Å—Ç–∞ –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è **–ù–ï** —É–¥–∞–ª—è–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç –∏–∑ Bitrix24
- –£–¥–∞–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏–∑ local storage

### –î–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

#### –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ (Bitrix24 ‚Üí App):
```typescript
// 1. –ó–∞–≥—Ä—É–∂–∞–µ–º Event ‚Üí –ø–æ–ª—É—á–∞–µ–º dealIds
// 2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ dealId:
//    - –ó–∞–≥—Ä—É–∂–∞–µ–º Deal ‚Üí –ø–æ–ª—É—á–∞–µ–º contactIds, surcharge, nights
//    - –î–ª—è –∫–∞–∂–¥–æ–≥–æ contactId:
//      - –ó–∞–≥—Ä—É–∂–∞–µ–º Contact ‚Üí –ø–æ–ª—É—á–∞–µ–º name, passport, phone, email, birthDate
// 3. –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ local storage —Å –ø—Ä–∏–≤—è–∑–∫–æ–π bitrixContactId –∏ bitrixDealId
```

#### –ü—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ (App ‚Üí Bitrix24):
```typescript
// Inline editing –ø–æ–ª—è —Ç—É—Ä–∏—Å—Ç–∞:
// 1. –û–±–Ω–æ–≤–ª—è–µ–º local storage
// 2. –ï—Å–ª–∏ –µ—Å—Ç—å bitrixContactId:
//    - –í—ã–∑—ã–≤–∞–µ–º saveTouristToContact(contactId, data)
//    - –û–±–Ω–æ–≤–ª—è–µ–º custom fields –≤ Bitrix24 Contact
```

**–û–±–Ω–æ–≤–ª—è–µ–º—ã–µ –ø–æ–ª—è Contact**:
- `ufCrm1700666127661` ‚Üê name
- `ufCrm1700667203530` ‚Üê passport
- `PHONE[0].VALUE` ‚Üê phone
- `EMAIL[0].VALUE` ‚Üê email
- `BIRTHDATE` ‚Üê birthDate

**–ù–ï –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è**:
- –ü–æ–ª—è Deal (surcharge, nights) - read-only –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
- Visits (–≥–æ—Ä–æ–¥–∞, –æ—Ç–µ–ª–∏, —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç) - —Ç–æ–ª—å–∫–æ –≤ local storage

### Backend API endpoints

#### `/api/event/:entityId`
**GET** - –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ Event
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `{ title: string | null, deals: [{id, title}][] }`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç: `getEntity()` + `getEventDeals()`

#### `/api/tourists/:entityId`
**GET** - –ü–æ–ª—É—á–∏—Ç—å —Ç—É—Ä–∏—Å—Ç–æ–≤ –¥–ª—è Event
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏–∑ Bitrix24 –µ—Å–ª–∏ local storage –ø—É—Å—Ç
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `TouristWithVisits[]`

**POST** `/api/tourists` - –°–æ–∑–¥–∞—Ç—å —Ç—É—Ä–∏—Å—Ç–∞
- –í–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ Zod schema
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ storage
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Bitrix24 Contact (–µ—Å–ª–∏ –µ—Å—Ç—å bitrixContactId)

**PATCH** `/api/tourists/:id` - –û–±–Ω–æ–≤–∏—Ç—å —Ç—É—Ä–∏—Å—Ç–∞
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ local storage
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Bitrix24 Contact

**DELETE** `/api/tourists/:id` - –£–¥–∞–ª–∏—Ç—å —Ç—É—Ä–∏—Å—Ç–∞
- –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –∏–∑ local storage
- **–ù–ï** —É–¥–∞–ª—è–µ—Ç Contact –∏–∑ Bitrix24

---

## –≠–∫—Å–ø–æ—Ä—Ç –∏ –æ–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏

### Share Dialog (–î–∏–∞–ª–æ–≥ –æ–±–º–µ–Ω–∞)

**–î–æ—Å—Ç—É–ø**:
- –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è" –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ —Ç–∞–±–ª–∏—Ü—ã
- –ò–∫–æ–Ω–∫–∞ "Link" –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ –∫–∞–∂–¥–æ–≥–æ –≥–æ—Ä–æ–¥–∞

**–û–ø—Ü–∏–∏**:
1. **–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É**
   - –ö–æ–ø–∏—Ä—É–µ—Ç URL —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ clipboard
   - –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ —Å fallback –¥–ª—è iframe
   - –†–∞–±–æ—Ç–∞–µ—Ç –≤ Bitrix24 iframe –∏ standalone

2. **–≠–∫—Å–ø–æ—Ä—Ç –≤ Excel**
   - –î–ª—è –ø–æ–ª–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã –∏–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≥–æ—Ä–æ–¥–∞
   - –§–æ—Ä–º–∞—Ç: `.xlsx` —Ñ–∞–π–ª
   - –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞: `xlsx`

### Excel Export —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

**–ö–æ–ª–æ–Ω–∫–∏**:
- ‚Ññ - –ø–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä
- –§–ò–û —Ç—É—Ä–∏—Å—Ç–∞
- –¢–µ–ª–µ—Ñ–æ–Ω
- –ü–∞—Å–ø–æ—Ä—Ç
- –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ –≥–æ—Ä–æ–¥–∞:
  - –î–∞—Ç–∞ –ø—Ä–∏–±—ã—Ç–∏—è
  - –í—Ä–µ–º—è –ø—Ä–∏–±—ã—Ç–∏—è
  - –î–∞—Ç–∞ –æ—Ç—ä–µ–∑–¥–∞
  - –í—Ä–µ–º—è –æ—Ç—ä–µ–∑–¥–∞
  - –û—Ç–µ–ª—å
  - –¢–∏–ø –∫–æ–º–Ω–∞—Ç—ã
  - –ü—Ä–∏–±—ã—Ç–∏–µ (—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç, —Ä–µ–π—Å, –∞—ç—Ä–æ–ø–æ—Ä—Ç, —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä)
  - –û—Ç—ä–µ–∑–¥ (—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç, —Ä–µ–π—Å, –∞—ç—Ä–æ–ø–æ—Ä—Ç, —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä)

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ**:
- Bitrix24 Contact ID
- Bitrix24 Deal ID
- –î–æ–ø–ª–∞—Ç–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
- –ù–æ—á–µ–π (–µ—Å–ª–∏ –µ—Å—Ç—å)

### Clipboard fallback –º–µ—Ö–∞–Ω–∏–∑–º

```typescript
// client/src/lib/clipboard.ts
async function copyToClipboard(text: string): Promise<boolean> {
  // 1. –ü—Ä–æ–±—É–µ–º modern Clipboard API
  if (navigator.clipboard?.writeText) {
    try {
      await navigator.clipboard.writeText(text);
      return true;
    } catch {}
  }
  
  // 2. Fallback –¥–ª—è iframe (Bitrix24)
  try {
    const textarea = document.createElement('textarea');
    textarea.value = text;
    textarea.style.position = 'fixed';
    textarea.style.opacity = '0';
    document.body.appendChild(textarea);
    textarea.select();
    const success = document.execCommand('copy');
    document.body.removeChild(textarea);
    return success;
  } catch {
    return false;
  }
}
```

---

## –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (DEV)

### –î–æ—Å—Ç—É–ø: `/dev`

**–¶–µ–ª—å**: Standalone —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Bitrix24

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –†–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–Ω–æ–º–Ω–æ
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç Bitrix24 SDK
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç mock –¥–∞–Ω–Ω—ã–µ (6 —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ç—É—Ä–∏—Å—Ç–æ–≤)
- –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –ª–æ–∫–∞–ª—å–Ω–æ

### Mock Data —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

**Deals**:
```typescript
const MOCK_DEALS = [
  { id: "5001", title: "–ú–∞—Ä—Ç 2025 - –ì—Ä—É–ø–ø–∞ –ê" },
  { id: "5003", title: "–ú–∞—Ä—Ç 2025 - –ì—Ä—É–ø–ø–∞ –í" },
  { id: "5005", title: "–ú–∞—Ä—Ç 2025 - VIP –≥—Ä—É–ø–ø–∞" },
  { id: "5007", title: "–ê–ø—Ä–µ–ª—å 2025 - –≠–∫—Å–ø—Ä–µ—Å—Å —Ç—É—Ä" }
];
```

**Tourists**: 6 —Ç—É—Ä–∏—Å—Ç–æ–≤ —Å —Ä–∞–∑–Ω—ã–º–∏ dealId, –ø–æ–ª–Ω—ã–º–∏ –º–∞—Ä—à—Ä—É—Ç–∞–º–∏, –æ—Ç–µ–ª—è–º–∏, —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–æ–º

**Event**:
```typescript
const MOCK_EVENT = {
  title: "–ö–∏—Ç–∞–π—Å–∫–∏–π —Ç—É—Ä - –ú–∞—Ä—Ç 2025",
  entityId: "DEV-001"
};
```

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –≤ DEV —Ä–µ–∂–∏–º–µ

**–†–∞–±–æ—Ç–∞–µ—Ç**:
- ‚úÖ Summary —Ç–∞–±–ª–∏—Ü–∞ —Å –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–æ–π
- ‚úÖ Dashboard —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
- ‚úÖ –°–ø–∏—Å–æ–∫ —Ç—É—Ä–∏—Å—Ç–æ–≤
- ‚úÖ Inline editing (–æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ local state)
- ‚úÖ –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞/—Ä–∞–∑–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ localStorage)
- ‚úÖ Share dialog
- ‚úÖ Excel export
- ‚úÖ –í—Å–µ UI interactions

**–ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç**:
- ‚ùå –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Bitrix24
- ‚ùå –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- ‚ùå –†–µ–∞–ª—å–Ω—ã–µ –≥–∏–ø–µ—Ä—Å—Å—ã–ª–∫–∏ –Ω–∞ Bitrix24 (–Ω–µ—Ç domain)

### Toast —Å–æ–æ–±—â–µ–Ω–∏—è –≤ DEV

–í—Å–µ toast –≤ `/dev` –∏–º–µ—é—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:
- "–û–±–Ω–æ–≤–ª–µ–Ω–æ (DEV —Ä–µ–∂–∏–º)"
- "–í —Ä–µ–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ –¥–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —Å Bitrix24"
- "–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ localStorage"

---

## –ò–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è

### –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞: i18next + react-i18next

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —è–∑—ã–∫–∏**:
- üá∑üá∫ –†—É—Å—Å–∫–∏–π (ru) - –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- üá¨üáß –ê–Ω–≥–ª–∏–π—Å–∫–∏–π (en)
- üá®üá≥ –ö–∏—Ç–∞–π—Å–∫–∏–π (zh)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–µ—Ä–µ–≤–æ–¥–æ–≤

**–§–∞–π–ª—ã**:
- `client/src/i18n/locales/ru.json`
- `client/src/i18n/locales/en.json`
- `client/src/i18n/locales/zh.json`

**–°–µ–∫—Ü–∏–∏**:
```json
{
  "common": {},        // –û–±—â–∏–µ —Å–ª–æ–≤–∞ (loading, error, save, cancel...)
  "nav": {},           // –ù–∞–≤–∏–≥–∞—Ü–∏—è
  "summary": {},       // –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
  "grouping": {},      // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞
  "sharing": {},       // –û–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏
  "fields": {},        // –ù–∞–∑–≤–∞–Ω–∏—è –ø–æ–ª–µ–π
  "transport": {},     // –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç
  "roomTypes": {},     // –¢–∏–ø—ã –∫–æ–º–Ω–∞—Ç
  "placeholders": {}, // –ü–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã –¥–ª—è input
  "toasts": {},        // Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  "devMode": {},       // DEV —Ä–µ–∂–∏–º
  "dashboard": {},     // –î–∞—à–±–æ—Ä–¥
  "table": {},         // –¢–∞–±–ª–∏—Ü–∞
  "tourist": {},       // –¢—É—Ä–∏—Å—Ç
  "cities": {},        // –ù–∞–∑–≤–∞–Ω–∏—è –≥–æ—Ä–æ–¥–æ–≤
  "errors": {},        // –û—à–∏–±–∫–∏
  "install": {}        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞
}
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```typescript
import { useTranslation } from 'react-i18next';

function MyComponent() {
  const { t } = useTranslation();
  
  return (
    <div>
      <h1>{t("summary.title", { count: 10, eventTitle: "Event" })}</h1>
      <button>{t("common.save")}</button>
    </div>
  );
}
```

### –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —è–∑—ã–∫–∞

```typescript
import { useTranslation } from 'react-i18next';

function LanguageSwitcher() {
  const { i18n } = useTranslation();
  
  return (
    <select value={i18n.language} onChange={(e) => i18n.changeLanguage(e.target.value)}>
      <option value="ru">–†—É—Å—Å–∫–∏–π</option>
      <option value="en">English</option>
      <option value="zh">‰∏≠Êñá</option>
    </select>
  );
}
```

### –ì–æ—Ä–æ–¥–∞ —Å –ø–µ—Ä–µ–≤–æ–¥–∞–º–∏

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è helper —Ñ—É–Ω–∫—Ü–∏—è:
```typescript
function getCityName(city: City): string {
  return t(`cities.${city}`);
}

// –†–µ–∑—É–ª—å—Ç–∞—Ç:
// ru: "–ü–µ–∫–∏–Ω"
// en: "Beijing"
// zh: "Âåó‰∫¨"
```

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### Frontend
- **React** 18+ —Å TypeScript
- **Wouter** - routing
- **TanStack Query** v5 - data fetching & caching
- **Shadcn UI** - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- **Tailwind CSS** - —Å—Ç–∏–ª–∏–∑–∞—Ü–∏—è
- **i18next** - –∏–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è
- **Bitrix24 JS SDK** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Bitrix24

### Backend
- **Express.js** - HTTP —Å–µ—Ä–≤–µ—Ä
- **TypeScript**
- **Zod** - –≤–∞–ª–∏–¥–∞—Ü–∏—è
- **In-memory storage** (development)

### Build & Dev Tools
- **Vite** - bundler –∏ dev server
- **tsx** - TypeScript execution

---

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ Bitrix24

**Endpoint**: `/public/install.html`

**–ü—Ä–æ—Ü–µ—Å—Å**:
1. –û—Ç–∫—Ä—ã—Ç—å `/public/install.html` –∏–∑ Bitrix24
2. Bitrix24 SDK –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è
3. –ö–ª–∏–∫ "–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–∫–ª–∞–¥–∫—É"
4. –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è placement: `CRM_DYNAMIC_176_DETAIL_TAB`
5. –í–∫–ª–∞–¥–∫–∞ "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø–æ–π" –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤–æ –≤—Å–µ—Ö Smart Process "–°–æ–±—ã—Ç–∏–µ"

**–ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞**: `/rebind.html` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π

### 2. Environment Variables

**Production**:
- `BITRIX24_WEBHOOK_URL` - webhook –¥–ª—è API –≤—ã–∑–æ–≤–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `SESSION_SECRET` - –¥–ª—è session management

**Development**:
- –ù–µ —Ç—Ä–µ–±—É—é—Ç—Å—è –¥–ª—è `/dev` —Ä–µ–∂–∏–º–∞

### 3. –ó–∞–ø—É—Å–∫

```bash
# Development
npm install
npm run dev

# Production
npm run build
npm start
```

**Dev server**: http://localhost:5000
- `/` - –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (—Ç—Ä–µ–±—É–µ—Ç Bitrix24)
- `/dev` - DEV —Ä–µ–∂–∏–º (standalone)

---

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: Entity ID –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞**: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å ID Smart Process —ç–ª–µ–º–µ–Ω—Ç–∞

**–†–µ—à–µ–Ω–∏–µ**:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ –∏–∑ –≤–∫–ª–∞–¥–∫–∏ –≤ –∫–∞—Ä—Ç–æ—á–∫–µ Smart Process
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å URL: –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å `/crm/type/176/details/:entityId/`
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `/rebind.html` –¥–ª—è –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∏ placement

### –ü—Ä–æ–±–ª–µ–º–∞: –¢—É—Ä–∏—Å—Ç—ã –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ Bitrix24

**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ `ufCrm9_1711887457` –∏–ª–∏ `ufCrm1702460537`

**–†–µ—à–µ–Ω–∏–µ**:
1. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤ Smart Process —ç–ª–µ–º–µ–Ω—Ç–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –ø–æ–ª–µ "Deals" (ufCrm9_1711887457)
2. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤ Deal –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –ø–æ–ª–µ "Tourists" (ufCrm1702460537)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π

### –ü—Ä–æ–±–ª–µ–º–∞: Clipboard –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ iframe

**–†–µ—à–µ–Ω–∏–µ**: –£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω fallback –º–µ—Ö–∞–Ω–∏–∑–º —Å `document.execCommand('copy')`

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–µ—Ä–µ–≤–æ–¥—ã –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞**: –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∫–ª—é—á–∏ –≤ locale —Ñ–∞–π–ª–∞—Ö

**–†–µ—à–µ–Ω–∏–µ**:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∫–ª—é—á —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤–æ –≤—Å–µ—Ö —Ç—Ä–µ—Ö —Ñ–∞–π–ª–∞—Ö (ru.json, en.json, zh.json)
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å dev server

---

## Roadmap & –£–ª—É—á—à–µ–Ω–∏—è

### –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ PostgreSQL –≤–º–µ—Å—Ç–æ in-memory storage
- [ ] Offline mode —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–≤—è–∑–∏
- [ ] Bulk operations –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç—É—Ä–∏—Å—Ç–æ–≤
- [ ] –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π (audit log)
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö –ø—Ä–∏–±—ã—Ç–∏—è—Ö
- [ ] –ü–µ—á–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç–Ω—ã—Ö –ª–∏—Å—Ç–æ–≤
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–µ–ª–µ–π
- [ ] Push notifications —á–µ—Ä–µ–∑ Bitrix24

---

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

**–ê–≤—Ç–æ—Ä**: Replit Agent  
**–í–µ—Ä—Å–∏—è**: 1.0.0  
**–î–∞—Ç–∞**: –û–∫—Ç—è–±—Ä—å 2025

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É –∏–ª–∏ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞.
