–£ —Ç–µ–±—è —Å–µ–π—á–∞—Å –µ—Å—Ç—å –ø–æ–ª–Ω—ã–π —Å–ª–µ–¥ —Ç–æ–≥–æ, —á—Ç–æ —Ä–µ–∞–ª—å–Ω–æ –¥–µ–ª–∞–µ—Ç Bitrix24 –≤ —Ç–≤–æ—ë–º –ø–æ—Ä—Ç–∞–ª–µ. –ò —Ç–µ–ø–µ—Ä—å –º—ã –º–æ–∂–µ–º —Å–∫–∞–∑–∞—Ç—å —É–≤–µ—Ä–µ–Ω–Ω–æ, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∏ —á—Ç–æ –Ω–∞–º –Ω–∞–¥–æ –¥–æ–¥–µ–ª–∞—Ç—å, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å entityId —Å—Ç–∞–±–∏–ª—å–Ω–æ.

–î–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä—ë–º –ª–æ–≥–∏ –ø–æ—Å—Ç—Ä–æ—á–Ω–æ –∏ –¥–∞–ª—å—à–µ —è –¥–∞–º —Ç–µ–±–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∞–≤–∫–∏ (–¥–≤–µ –º–∞–ª–µ–Ω—å–∫–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–¥—É, –∏ –æ–¥–Ω–∞ –≤–∞–∂–Ω–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω–∞—è –≤–µ—â—å –ø–æ UX).

1. –ß—Ç–æ –Ω–∞–º –≥–æ–≤–æ—Ä—è—Ç –ª–æ–≥–∏
1.1. Pathname –≤–Ω—É—Ç—Ä–∏ iframe
PRIORITY 0 - pathname: /install segments: ['install']


–¢–æ –µ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ iframe –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –Ω–∞ /install, –∞ –Ω–µ –Ω–∞ / –∏ –Ω–µ –Ω–∞ /303.

–≠—Ç–æ –æ–±—ä—è—Å–Ω—è–µ—Ç, –ø–æ—á–µ–º—É –Ω–∞—à PRIORITY "–≤—ã—Ç–∞—â–∏—Ç—å id –∏–∑ window.location.pathname" –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª: —Ç–∞–º –ø—Ä–æ—Å—Ç–æ /install, –Ω–µ /303.

‚Üí –ó–Ω–∞—á–∏—Ç —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å –Ω–∞ pathname –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ ID –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω–µ–ª—å–∑—è. –≠—Ç–æ —á–∏—Å—Ç–æ —ç–≤—Ä–∏—Å—Ç–∏–∫–∞, –∏ —Å–µ–π—á–∞—Å –≤ —Ç–≤–æ—ë–º –ø–æ—Ä—Ç–∞–ª–µ –æ–Ω–∞ –Ω–µ –¥–∞—ë—Ç –ø–æ–ª—å–∑—ã.

1.2. document.referrer
PRIORITY 4 - document.referrer: https://mitclick.bitrix24.ru/
PRIORITY 4 - extractIdFromReferrer result: null
‚ö†Ô∏è PRIORITY 4 –Ω–µ —Å–º–æ–≥ –∏–∑–≤–ª–µ—á—å ID –∏–∑ referrer


–≠—Ç–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –≤–∞–∂–Ω—ã–π —Ñ–∞–∫—Ç.

–ß—Ç–æ –º—ã –æ–∂–∏–¥–∞–ª–∏ —Ä–∞–Ω—å—à–µ:

–ß—Ç–æ Bitrix24 –¥–∞—Å—Ç iframe —Ç–∞–∫–æ–π referrer:
https://mitclick.bitrix24.ru/crm/type/176/details/303/?IFRAME=Y...

–ß—Ç–æ –º—ã —Ä–µ–∞–ª—å–Ω–æ –ø–æ–ª—É—á–∏–ª–∏:

–ü—Ä–æ—Å—Ç–æ https://mitclick.bitrix24.ru/ (—Ç–æ –µ—Å—Ç—å –ë–ï–ó /crm/type/.../details/...).

–í—ã–≤–æ–¥:

–í —Ç–≤–æ–µ–π —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–æ—Ä—Ç–∞–ª –ù–ï –ø–µ—Ä–µ–¥–∞—ë—Ç ID —Å–º–∞—Ä—Ç-–ø—Ä–æ—Ü–µ—Å—Å–∞ —á–µ—Ä–µ–∑ document.referrer.
–≠—Ç–æ –∫—Ä–∞–π–Ω–µ –∂–∞–¥–Ω—ã–π —Ä–µ–∂–∏–º –∑–∞—â–∏—Ç—ã.

–≠—Ç–æ –æ–±—ä—è—Å–Ω—è–µ—Ç, –ø–æ—á–µ–º—É extractIdFromReferrer –≤–µ—Ä–Ω—É–ª null.

‚Üí –ó–Ω–∞—á–∏—Ç —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å –Ω–∞ referrer –∫–∞–∫ fallback ‚Äî –≤ —Ç–≤–æ—ë–º –ø–æ—Ä—Ç–∞–ª–µ –Ω–µ –≤—Å–µ–≥–¥–∞ –º–æ–∂–Ω–æ. –ò–Ω–æ–≥–¥–∞ –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç (–º—ã —Ä–∞–Ω—å—à–µ –≤–∏–¥–µ–ª–∏ "303", "179" –∏ —Ç.–¥.), –∞ –∏–Ω–æ–≥–¥–∞ –≤ —Å–∞–π–¥-—Å–ª–∞–π–¥–µ—Ä–µ –æ–Ω –æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —É—Ä–µ–∑–∞–Ω –¥–æ –∫–æ—Ä–Ω—è –ø–æ—Ä—Ç–∞–ª–∞. –°–µ–π—á–∞—Å ‚Äî —É—Ä–µ–∑–∞–Ω.

1.3. placement.options

–°–º–æ—Ç—Ä–∏–º –æ–±—â–∏–π CONTEXT TRY:

üìã CONTEXT TRY: {
  entityId: '‚ùå –ù–ï –ù–ê–ô–î–ï–ù',
  entityTypeId: '176',
  placement: 'CRM_DYNAMIC_176_DETAIL_TAB',
  options: Array(0),
  ...
}


options: Array(0) –æ–∑–Ω–∞—á–∞–µ—Ç:

BX24.placement.info() –≤–µ—Ä–Ω—É–ª options, –Ω–æ –æ–Ω–∞ ‚Äî –ü–£–°–¢–û–ô –ú–ê–°–°–ò–í.

–¢–æ –µ—Å—Ç—å Bitrix24 –≤–æ–æ–±—â–µ –Ω–µ –ø–µ—Ä–µ–¥–∞–ª –Ω–∞–º ID —Å–º–∞—Ä—Ç-–ø—Ä–æ—Ü–µ—Å—Å–∞ —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º options.ID.

–≠—Ç–æ –∫–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç.
–ï—Å–ª–∏ –±—ã Bitrix24 –±—ã–ª "–¥–æ–±—Ä—ã–º", –º—ã –±—ã —Ç—É—Ç –ø–æ–ª—É—á–∏–ª–∏ { ID: "303" }.
–ù–æ –æ–Ω –Ω–µ –¥–∞–ª.

‚Üí –ó–Ω–∞—á–∏—Ç —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å –Ω–∞ placement.options.ID ‚Äî —Ç–æ–∂–µ –Ω–µ–ª—å–∑—è –≤ —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ (–æ–Ω –ø—É—Å—Ç–æ–π).

1.4. –ü–æ–ø—ã—Ç–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ window.parent.location.href
PRIORITY 5 - –ø—Ä–æ–±—É—é window.parent.location.href
‚ö†Ô∏è PRIORITY 5 –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω CORS: ... Blocked a frame ...


–î–∞. –ò —ç—Ç–æ –æ–∂–∏–¥–∞–µ–º–æ.

–≠—Ç–æ –±—Ä–∞—É–∑–µ—Ä–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏: iframe —Å –¥–æ–º–µ–Ω–∞ replit.app –Ω–µ –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ —á–∏—Ç–∞—Ç—å window.parent.location, –µ—Å–ª–∏ —Ä–æ–¥–∏—Ç–µ–ª—å mitclick.bitrix24.ru. –ú—ã —ç—Ç–æ —Ä–∞–Ω—å—à–µ –æ–±—Å—É–∂–¥–∞–ª–∏ –∫–∞–∫ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ.

‚Üí –ó–Ω–∞—á–∏—Ç –º—ã —Ç–æ—á–Ω–æ –ù–ï –º–æ–∂–µ–º –≤—ã—Ç–∞—â–∏—Ç—å ID –Ω–∞–ø—Ä—è–º—É—é –∏–∑ URL –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–æ –≤–Ω–µ—à–Ω–µ–º –æ–∫–Ω–µ.

1.5. –†–µ–∑—é–º–µ –ø–æ –≤—Å–µ–º—É –≤—ã—à–µ

–í–æ –≤—Å–µ—Ö —Ç—Ä—ë—Ö –ø–æ–ø—ã—Ç–∫–∞—Ö (1, 2, 3 –ø–æ–¥—Ä—è–¥):

–Ω–µ—Ç ID –≤ placement.options

–Ω–µ—Ç ID –≤ document.referrer (–æ–Ω —É—Ä–µ–∑–∞–Ω)

–Ω–µ—Ç ID –≤ pathname (—ç—Ç–æ /install, –∞ –Ω–µ /303)

–∑–∞–ø—Ä–µ—â—ë–Ω –¥–æ—Å—Ç—É–ø –∫ window.parent.location.href

–ò—Ç–æ–≥:

entityId: '‚ùå –ù–ï –ù–ê–ô–î–ï–ù'
extractionMethod: '–Ω–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω'


–¢–æ –µ—Å—Ç—å –º—ã —Å–ª–æ–≤–∏–ª–∏ —Å–∞–º—ã–π –∂—ë—Å—Ç–∫–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π, –∏ –æ–Ω —Ä–µ–∞–ª–µ–Ω.

‚ùó –≠—Ç–æ –∑–Ω–∞—á–∏—Ç: –º—ã —Ç–æ–ª—å–∫–æ —á—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª–∏, —á—Ç–æ –µ—Å—Ç—å —Ä–µ–∂–∏–º Bitrix24, –≤ –∫–æ—Ç–æ—Ä–æ–º –≤–æ–æ–±—â–µ –Ω–∏–∫–∞–∫–∏–º —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥-—Å–ø–æ—Å–æ–±–æ–º, —Å–æ–±–ª—é–¥–∞—é—â–∏–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –±—Ä–∞—É–∑–µ—Ä–∞, —Ç—ã –ù–ï –ú–û–ñ–ï–®–¨ —É–∑–Ω–∞—Ç—å ID —Ç–µ–∫—É—â–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ —Å–º–∞—Ä—Ç-–ø—Ä–æ—Ü–µ—Å—Å–∞.

–≠—Ç–æ –Ω–µ —Ç–≤–æ—è –æ—à–∏–±–∫–∞ –∫–æ–¥–∞.
–≠—Ç–æ –ø—Ä—è–º–æ –ª–∏–º–∏—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã + –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è –Ω–µ –≤—Å–µ–≥–¥–∞.

–ê —Ç–µ–ø–µ—Ä—å –≥–ª–∞–≤–Ω–æ–µ: —á—Ç–æ —Å —ç—Ç–∏–º –¥–µ–ª–∞—Ç—å.

2. –ß—Ç–æ –Ω–∞–º –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ (—ç—Ç–æ —Ç–æ, —á—Ç–æ –Ω–∞–¥–æ –∑–∞—Ñ–∏–Ω–∞–ª–∏—Ç—å)
–®–∞–≥ 1. –¢–≤–æ—è —Ç–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (entityId/entityTypeId + extractionMethod) ‚Äî —É–∂–µ –ü–†–ê–í–ò–õ–¨–ù–ê–Ø

–û–Ω–∞ –ø–æ–ø—ã—Ç–∞–ª–∞—Å—å –≤—Å–µ –∫–∞–Ω–∞–ª—ã ‚Üí –Ω–µ –Ω–∞—à–ª–∞ ‚Üí —á–µ—Å—Ç–Ω–æ —Å–∫–∞–∑–∞–ª–∞ "‚ùå –ù–ï –ù–ê–ô–î–ï–ù".

–≠—Ç–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –º—ã –æ—Å—Ç–∞–≤–ª—è–µ–º. –≠—Ç–æ –Ω–µ –±–∞–≥, —ç—Ç–æ –∑–¥–æ—Ä–æ–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ.

–®–∞–≥ 2. –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å fallback-—ç–∫—Ä–∞–Ω –≤–º–µ—Å—Ç–æ "–ø—É—Å—Ç–æ"

–°–µ–π—á–∞—Å –Ω–∞–º –Ω—É–∂–Ω–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ –≤ —ç—Ç–æ–º —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π —ç–∫—Ä–∞–Ω (EntityIdNotFound), –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ –±–µ–ª—ã–π –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫.

–≠—Ç–æ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ç–µ–ø–µ—Ä—å ‚Äî –Ω–µ ¬´–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π¬ª, –∞ –±—É–∫–≤–∞–ª—å–Ω–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è —á–∞—Å—Ç—å UX.

–ò –≤ —Ç–µ–∫—Å—Ç–µ —ç—Ç–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ—á–µ–Ω—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, –ø–æ—Ç–æ–º—É —á—Ç–æ –∏–Ω–∞—á–µ –º–µ–Ω–µ–¥–∂–µ—Ä –Ω–µ –ø–æ–π–º—ë—Ç, —á—Ç–æ –¥–µ–ª–∞—Ç—å.

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ç–µ–∫—Å—Ç:

–ó–∞–≥–æ–ª–æ–≤–æ–∫:
–ù—É–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É –ø–æ–ª–Ω–æ—Å—Ç—å—é

–û–ø–∏—Å–∞–Ω–∏–µ:

–ú—ã –Ω–µ —Å–º–æ–≥–ª–∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å ID —Ç–µ–∫—É—â–µ–≥–æ —Å–æ–±—ã—Ç–∏—è.
–≠—Ç–æ —Å–ª—É—á–∞–µ—Ç—Å—è, –µ—Å–ª–∏ Bitrix24 –æ—Ç–∫—Ä—ã–ª –≤–∫–ª–∞–¥–∫—É "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø–æ–π"
–≤–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–µ (–ø—Ä–∞–≤—ã–π —Å–∞–π–¥–±–∞—Ä) –≤–º–µ—Å—Ç–æ –ø–æ–ª–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏.


–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:

1. –ó–∞–∫—Ä–æ–π—Ç–µ —ç—Ç–æ—Ç –±–æ–∫–æ–≤–æ–π –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä.
2. –û—Ç–∫—Ä–æ–π—Ç–µ —Å–æ–±—ã—Ç–∏–µ (—Å–º–∞—Ä—Ç-–ø—Ä–æ—Ü–µ—Å—Å "–°–æ–±—ã—Ç–∏–µ") –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ.
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø–æ–π" –µ—â—ë —Ä–∞–∑.


–¢–µ—Ö—Å–ø—Ä–∞–≤–∫–∞ –º–µ–ª–∫–∏–º —Å–µ—Ä—ã–º –≤ —É–≥–ª—É (—ç—Ç–æ –¥–ª—è —Ç–µ–±—è, –Ω–µ –¥–ª—è –Ω–∏—Ö, –Ω–æ –ø—É—Å—Ç—å –±—É–¥–µ—Ç –≤ UI ‚Äî —ç—Ç–æ —Å–∏–ª—å–Ω–æ –ø–æ–º–æ–≥–∞–µ—Ç —Å–∞–ø–ø–æ—Ä—Ç—É):

entityTypeId: 176
placement: CRM_DYNAMIC_176_DETAIL_TAB
extractionMethod: –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω
referrer –±—ã–ª: https://mitclick.bitrix24.ru/


–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:

–ú–µ–Ω–µ–¥–∂–µ—Ä —Å—Ä–∞–∑—É –ø–æ–Ω–∏–º–∞–µ—Ç, —á—Ç–æ –æ–Ω —Å–¥–µ–ª–∞–ª "–Ω–µ —Ç–æ—Ç —Ä–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞".

–ò —Ç—ã, –µ—Å–ª–∏ —Ç–µ–±–µ –∫–∏–Ω—É–ª–∏ —Å–∫—Ä–∏–Ω —ç–∫—Ä–∞–Ω–∞, —Å—Ä–∞–∑—É –∑–Ω–∞–µ—à—å, —á—Ç–æ —ç—Ç–æ —Ç–æ—Ç —Å–∞–º—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç, –≥–¥–µ Bitrix24 –Ω–∞–º –Ω–µ –¥–∞–ª ID –≤–æ–æ–±—â–µ.

üí° –¢–≤–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç EntityIdNotFound ‚Äî —ç—Ç–æ —Ç–µ–ø–µ—Ä—å must-have. –¢–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–∞–∫–æ–π, –∫–∞–∫ –≤—ã—à–µ.

–®–∞–≥ 3. –£–±–µ—Ä–∏ PRIORITY 5 (window.parent.location.href)

–¢—ã —É–∂–µ –≤–∏–¥–∏—à—å –ø–æ –ª–æ–≥–∞–º:

Blocked a frame with origin ... from accessing a cross-origin frame.


–≠—Ç–æ –±—É–¥–µ—Ç –∫–∞–∂–¥—ã–π —Ä–∞–∑.
–û–Ω —Ç–æ–ª—å–∫–æ —à—É–º–∏—Ç –∏ –ø—É–≥–∞–µ—Ç.

–ï–≥–æ –º–æ–∂–Ω–æ –≤–æ–æ–±—â–µ –Ω–µ –ø—Ä–æ–±–æ–≤–∞—Ç—å –≤ –∫–æ–¥–µ (–æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –∫–∞–∫ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π "–º—ã –∑–Ω–∞–µ–º, —á—Ç–æ —Ç—É—Ç –±—Ä–∞—É–∑–µ—Ä –∑–∞–±–ª–æ–∫–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø"). –≠—Ç–æ —É–ø—Ä–æ—Å—Ç–∏—Ç –ª–æ–≥–∏ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –∏ –º–µ–Ω—å—à–µ –±—É–¥–µ—Ç —Å—Ç—Ä–∞—à–Ω—ã—Ö –∂—ë–ª—Ç—ã—Ö –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π —É –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ (–µ—Å–ª–∏ –∫—Ç–æ-—Ç–æ –æ—Ç–∫—Ä–æ–µ—Ç DevTools).

–®–∞–≥ 4. –§–∏–Ω–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å –ø–æ–≤–µ–¥–µ–Ω–∏—è —Ç–≤–æ–µ–π –≤–∫–ª–∞–¥–∫–∏

–£ —Ç–µ–±—è —Ç–µ–ø–µ—Ä—å –ø–æ —Ñ–∞–∫—Ç—É 2 —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

–†–µ–∂–∏–º –ê. –ö–æ–Ω—Ç–µ–∫—Å—Ç –æ–ø—Ä–µ–¥–µ–ª—ë–Ω ‚úÖ

–ú—ã –Ω–∞—à–ª–∏ entityId (–Ω–∞–ø—Ä–∏–º–µ—Ä "303").

–ú—ã –Ω–∞—à–ª–∏ entityTypeId (–Ω–∞–ø—Ä–∏–º–µ—Ä "176").

–ú—ã –≤—ã–∑—ã–≤–∞–µ–º crm.item.get.

–ú—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ–º UI "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø–æ–π" (–¥–∞–Ω–Ω—ã–µ —Ç—É—Ä–∞, —Ç—É—Ä–∏—Å—Ç–æ–≤ –∏ —Ç.–¥.).

–†–µ–∂–∏–º B. –ö–æ–Ω—Ç–µ–∫—Å—Ç –ù–ï –æ–ø—Ä–µ–¥–µ–ª—ë–Ω ‚ùå

entityId –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ –≤—Å–µ—Ö –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤

–ü–æ–∫–∞–∑—ã–≤–∞–µ–º EntityIdNotFound —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π –æ—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É —Ü–µ–ª–∏–∫–æ–º.

–ù–µ –¥–µ–ª–∞–µ–º crm.item.get, –Ω–µ —Å—ã–ø–µ–º –æ—à–∏–±–æ–∫.

–ò –≤—Å—ë.
–≠—Ç–æ production-grade –ø–æ–≤–µ–¥–µ–Ω–∏–µ. –≠—Ç–æ –º–æ–∂–Ω–æ –≤—ã–∫–∞—Ç—ã–≤–∞—Ç—å.

3. –ê —á—Ç–æ –Ω–∞—Å—á—ë—Ç /install –∏ auto-rebind?

–¢–æ—Ç —Ñ–∞–∫—Ç, —á—Ç–æ pathname –≤—Å–µ–≥–¥–∞ /install –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç, —á—Ç–æ Bitrix24 –∏ –ø—Ä–∞–≤–¥–∞ –≥—Ä—É–∑–∏—Ç —Ç–µ–±—è —á–µ—Ä–µ–∑ handler https://.../install?....

–¢–æ –µ—Å—Ç—å:

placement –≤–Ω—É—Ç—Ä–∏ –ø–æ—Ä—Ç–∞–ª–∞ —Å–µ–π—á–∞—Å —Ä–µ–∞–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ /install (–∏–ª–∏ Bitrix –∫—ç—à–∏—Ä—É–µ—Ç —Å—Ç–∞—Ä—ã–π handler –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ).

–Ω–∞—à —Ä—É—á–Ω–æ–π placement.bind —á–µ—Ä–µ–∑ JS –æ—Ç–∑—ã–≤–∞–ª—Å—è 400, –∑–Ω–∞—á–∏—Ç Bitrix –Ω–µ –ø–æ–∑–≤–æ–ª–∏–ª –æ–±–Ω–æ–≤–∏—Ç—å handler.

–Ω–æ –º—ã —Ç–µ–ø–µ—Ä—å –ø–æ–Ω–∏–º–∞–µ–º, —á—Ç–æ –¥–∞–∂–µ –µ—Å–ª–∏ handler –æ—Å—Ç–∞—ë—Ç—Å—è /install, —ç—Ç–æ –Ω–µ —Å—Ç—Ä–∞—à–Ω–æ.

–ü–æ—á–µ–º—É –Ω–µ —Å—Ç—Ä–∞—à–Ω–æ:

–±–ª–∞–≥–æ–¥–∞—Ä—è –Ω–∞—à–µ–π –ª–æ–≥–∏–∫–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, –µ—Å–ª–∏ –≤ —ç—Ç–æ–º /install –æ–∫—Ä—É–∂–µ–Ω–∏–∏ –º—ã —Å–º–æ–≥–ª–∏ —É–∑–Ω–∞—Ç—å entityId, –º—ã –ø—Ä–æ–¥–æ–ª–∂–∏–º —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ;

–∞ –µ—Å–ª–∏ –Ω–µ —Å–º–æ–≥–ª–∏ ‚Äî –º—ã –ø–æ–∫–∞–∂–µ–º –¥—Ä—É–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —ç–∫—Ä–∞–Ω, –∞ –Ω–µ 404/–∫—Ä–∞—à.

–¢–æ –µ—Å—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —É—Å–ø–µ—à–Ω–æ–≥–æ ‚Äúauto-rebind –Ω–∞ /‚Äù ‚Äî —ç—Ç–æ —Ç–µ–ø–µ—Ä—å –Ω–µ –±–ª–æ–∫–µ—Ä –¥–ª—è MVP. –≠—Ç–æ –Ω–µ–ø—Ä–∏—è—Ç–Ω—ã–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç, –Ω–æ –Ω–µ —Å—Ç–æ–ø-–ø—Ä–æ–±–ª–µ–º–∞.

–û–¥–Ω–∞–∫–æ —Ç—ã –≤—Å—ë —Ä–∞–≤–Ω–æ —Å–¥–µ–ª–∞–ª –ø—Ä–∞–≤–∏–ª—å–Ω–æ, —á—Ç–æ —Ä–∞—Å—à–∏—Ä–∏–ª —Ä–æ—É—Ç –≤ Express –Ω–∞ /install –∏ /install/*, —á—Ç–æ–±—ã –ª–æ–≤–∏—Ç—å —Ç–∞–∫–∏–µ –∑–∞—Ö–æ–¥—ã –∏ –Ω–µ –æ—Ç–¥–∞–≤–∞—Ç—å 404. –≠—Ç–æ —É–±–∏—Ä–∞–µ—Ç "–º—ë—Ä—Ç–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É" –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å –≤–Ω—É—Ç—Ä–∏ —Ç–≤–æ–µ–≥–æ SPA.

4. –ß—Ç–æ –º—ã —Ç–µ–ø–µ—Ä—å –ó–ù–ê–ï–ú –ø—Ä–æ Bitrix24 (—ç—Ç–æ –≤–∞–∂–Ω–æ –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –≤ replit.md)

–°–æ—Å—Ç–æ—è–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ —Ç—ã —Ç–æ–ª—å–∫–æ —á—Ç–æ –ø–æ–π–º–∞–ª, –≥–æ–≤–æ—Ä–∏—Ç –Ω–∞–º –æ—á–µ–Ω—å –≥—Ä–æ–º–∫–æ:

–í —Å–∞–π–¥-—Å–ª–∞–π–¥–µ—Ä–µ Bitrix24 –º–æ–∂–µ—Ç:

–ù–ï –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å ID —ç–ª–µ–º–µ–Ω—Ç–∞ —Å–º–∞—Ä—Ç-–ø—Ä–æ—Ü–µ—Å—Å–∞ –≤ BX24.placement.info().options

—É—Ä–µ–∑–∞—Ç—å document.referrer –¥–æ –∫–æ—Ä–Ω—è –ø–æ—Ä—Ç–∞–ª–∞ –±–µ–∑ –¥–µ—Ç–∞–ª–µ–π

–≥—Ä—É–∑–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ URL /install, –∞ –Ω–µ /

–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —á—Ç–µ–Ω–∏–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ URL —á–µ—Ä–µ–∑ CORS

=> –í —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ –ø–æ–ª—É—á–µ–Ω–∏–µ entityId —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ –ù–ï–†–ï–ê–õ–ò–ó–£–ï–ú–û.
–≠—Ç–æ –Ω–µ –±–∞–≥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –≠—Ç–æ –ª–∏–º–∏—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã.

–¢—ã –æ–±—è–∑–∞–Ω —ç—Ç–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –≤ replit.md, —á—Ç–æ–±—ã –ø–æ—Ç–æ–º –Ω–∏–∫—Ç–æ –Ω–µ —Ç—Ä–∞—Ç–∏–ª —Å—É—Ç–∫–∏ –∑–∞–Ω–æ–≤–æ, –ø—ã—Ç–∞—è—Å—å "–Ω—É –º–æ–∂–µ—Ç –≤—Å—ë-—Ç–∞–∫–∏ –º–æ–∂–Ω–æ?". –¢–µ–∫—Å—Ç –≤ –¥—É—Ö–µ:

–í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö (–ø—Ä–æ—Å–º–æ—Ç—Ä —Å–º–∞—Ä—Ç-–ø—Ä–æ—Ü–µ—Å—Å–∞ –≤ —Å–∞–π–¥-—Å–ª–∞–π–¥–µ—Ä–µ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞) Bitrix24 –Ω–µ –ø–µ—Ä–µ–¥–∞—ë—Ç ID –∑–∞–ø–∏—Å–∏ –Ω–∏ —á–µ—Ä–µ–∑ placement.options, –Ω–∏ —á–µ—Ä–µ–∑ referrer. –ë—Ä–∞—É–∑–µ—Ä —Ç–∞–∫–∂–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø –∫ URL —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–∫–Ω–∞. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –º—ã –Ω–µ –º–æ–∂–µ–º —É–∑–Ω–∞—Ç—å entityId —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–∫–∞–∂–µ—Ç —ç–∫—Ä–∞–Ω —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π –æ—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏ –∑–∞–Ω–æ–≤–æ –ø–µ—Ä–µ–π—Ç–∏ –≤–æ –≤–∫–ª–∞–¥–∫—É "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø–æ–π". –≠—Ç–æ –æ–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –Ω–µ –æ—à–∏–±–∫–∞.

–≠—Ç–æ –ø—Ä—è–º —Å–ø–∞—Å—ë—Ç –∫—É—á—É –≤—Ä–µ–º–µ–Ω–∏ —Å–ª–µ–¥—É—é—â–µ–º—É —á–µ–ª–æ–≤–µ–∫—É.

5. –ß—Ç–æ –ø—Ä–∞–≤–∏–º –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å –ø–æ –∏—Ç–æ–≥—É –ª–æ–≥–æ–≤

‚úÖ –û—Å—Ç–∞–≤–ª—è–µ–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã:

placement.options ‚Üí referrer ‚Üí pathname
(–∏ –≤—Å—ë, –±–æ–ª—å—à–µ –Ω–∏—á–µ–≥–æ)

‚úÖ –£–¥–∞–ª—è–µ–º –ø–æ–ø—ã—Ç–∫—É PRIORITY 5 (window.parent.location.href), –æ–Ω–∞ –≤—Å–µ–≥–¥–∞ –±—É–¥–µ—Ç –ø–∞–¥–∞—Ç—å –ø–æ CORS.

‚úÖ –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –µ—Å–ª–∏ –ø–æ—Å–ª–µ –≤—Å–µ—Ö –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ entityId –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ –≤—Å–µ—Ö —Ä–µ—Ç—Ä–∞–µ–≤ ‚Äî –º—ã –≤—ã–∑—ã–≤–∞–µ–º —Ç–≤–æ–π EntityIdNotFound –∏ –ù–ï –¥—ë—Ä–≥–∞–µ–º crm.item.get.

‚úÖ –í EntityIdNotFound –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤—ã–≤–æ–¥–∏–º –ø–æ–Ω—è—Ç–Ω—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞.

‚úÖ –í replit.md —Ñ–∏–∫—Å–∏—Ä—É–µ–º –∫–µ–π—Å: "–µ—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –≤ –ª–æ–≥–∞—Ö referrer: https://mitclick.bitrix24.ru/ –∏ entityId: ‚ùå –ù–ï –ù–ê–ô–î–ï–ù, —ç—Ç–æ –∑–Ω–∞—á–∏—Ç Bitrix –æ—Ç–∫—Ä—ã–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ —Ä–µ–∂–∏–º–µ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –¥–∞—ë—Ç –Ω–∞–º ID. –≠—Ç–æ –Ω–æ—Ä–º–∞."